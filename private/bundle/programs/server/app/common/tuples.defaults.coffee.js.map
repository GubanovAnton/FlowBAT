{"version":3,"sources":["tuples.defaults.coffee"],"names":[],"mappings":";AAAA;;AAAA,eAAe,SAAC,MAAD,EAAS,OAAT,IAAf;;AAAA,KAEK,CAAC,MAAM,CAAC,MAAM,CAAC,MAApB,CAA2B,SAAC,MAAD,EAAS,KAAT;AACzB;AAAA,OAAK,CAAC,GAAN,GAAY,KAAK,CAAC,GAAN,IAAa,MAAM,CAAC,EAAP,EAAzB;AAAA,EACA,MAAU,UADV;AAAA,EAEA,CAAC,CAAC,QAAF,CAAW,KAAX,EACE;AAAA,UAAM,EAAN;AAAA,IACA,MAAM,EADN;AAAA,IAEA,UAAU,EAFV;AAAA,IAGA,eAAe,IAHf;AAAA,IAIA,OAAO,IAJP;AAAA,IAKA,SAAS,MALT;AAAA,IAMA,WAAW,GANX;AAAA,IAOA,WAAW,GAPX;GADF,CAFA;AAYA,MAAG,MAAS,CAAC,IAAb;AACE,aAAS,gBAAT;AAAA,IACA,QAAQ,KAAK,CAAC,MAAM,CAAC,IAAb,CAAkB;AAAA,MAAE,MAAM;AAAA,QAAE,QAAQ,MAAM,MAAhB;AAAA,QAAwB,UAAU,GAAlC;OAAR;KAAlB,CAAoE,CAAC,KAArE,EADR;AAAA,IAEA,KAAK,CAAC,IAAN,GAAa,MAFb;AAGA,QAAG,KAAH;AACE,WAAK,CAAC,IAAN,IAAc,OAAO,KAAP,GAAe,GAA7B,CADF;KAJF;GAZA;SAkBA,YAAY,CAAC,IAAb,CAAkB,IAAlB,EAAqB,MAArB,EAA6B,KAA7B,EAnByB;AAAA,CAA3B,CAFA;;AAAA,KAuBK,CAAC,MAAM,CAAC,MAAM,CAAC,MAApB,CAA2B,SAAC,MAAD,EAAS,KAAT,EAAgB,UAAhB,EAA4B,QAA5B,EAAsC,OAAtC;AACzB;AAAA,QAAU,UAAV;AAAA,EACA,QAAQ,CAAC,IAAT,GAAgB,QAAQ,CAAC,IAAT,IAAiB,EADjC;AAAA,EAEA,QAAQ,CAAC,IAAI,CAAC,SAAd,GAA0B,QAAQ,CAAC,IAAI,CAAC,SAAd,IAA2B,GAFrD;SAGA,YAAY,CAAC,IAAb,CAAkB,IAAlB,EAAqB,MAArB,EAA6B,QAAQ,CAAC,IAAtC,EAJyB;AAAA,CAA3B,CAvBA","file":"/common/tuples.defaults.coffee.js","sourcesContent":["tuplePreSave = (userId, changes) ->\n\nshare.Tuples.before.insert (userId, tuple) ->\n  tuple._id = tuple._id || Random.id()\n  now = new Date()\n  _.defaults(tuple,\n    name: \"\"\n    note: \"\"\n    contents: \"\"\n    isOutputStale: true\n    isNew: true\n    ownerId: userId\n    updatedAt: now\n    createdAt: now\n  )\n  if not tuple.name\n    prefix = \"New Tuple File\"\n    count = share.Tuples.find({ name: { $regex: \"^\" + prefix, $options: \"i\" } }).count()\n    tuple.name = prefix\n    if count\n      tuple.name += \" (\" + count + \")\"\n  tuplePreSave.call(@, userId, tuple)\n\nshare.Tuples.before.update (userId, tuple, fieldNames, modifier, options) ->\n  now = new Date()\n  modifier.$set = modifier.$set or {}\n  modifier.$set.updatedAt = modifier.$set.updatedAt or now\n  tuplePreSave.call(@, userId, modifier.$set)\n"]}