{"version":3,"sources":["meteor://ðŸ’»app/common/tuples.defaults.coffee"],"names":["tuplePreSave","userId","changes","share","Tuples","before","insert","tuple","count","now","prefix","_id","Random","id","Date","_","defaults","name","note","contents","isOutputStale","isNew","ownerId","updatedAt","createdAt","find","$regex","$options","call","update","fieldNames","modifier","options","$set"],"mappings":";;;;;;;;;AAAA,IAAAA,YAAA;;AAAAA,eAAe,UAACC,MAAD,EAASC,OAAT,IAAf;;AAEAC,MAAMC,MAAN,CAAaC,MAAb,CAAoBC,MAApB,CAA2B,UAACL,MAAD,EAASM,KAAT;AACzB,MAAAC,KAAA,EAAAC,GAAA,EAAAC,MAAA;AAAAH,QAAMI,GAAN,GAAYJ,MAAMI,GAAN,IAAaC,OAAOC,EAAP,EAAzB;AACAJ,QAAM,IAAIK,IAAJ,EAAN;;AACAC,IAAEC,QAAF,CAAWT,KAAX,EACE;AAAAU,UAAM,EAAN;AACAC,UAAM,EADN;AAEAC,cAAU,EAFV;AAGAC,mBAAe,IAHf;AAIAC,WAAO,IAJP;AAKAC,aAASrB,MALT;AAMAsB,eAAWd,GANX;AAOAe,eAAWf;AAPX,GADF;;AAUA,MAAG,CAAIF,MAAMU,IAAb;AACEP,aAAS,gBAAT;AACAF,YAAQL,MAAMC,MAAN,CAAaqB,IAAb,CAAkB;AAAER,YAAM;AAAES,gBAAQ,MAAMhB,MAAhB;AAAwBiB,kBAAU;AAAlC;AAAR,KAAlB,EAAqEnB,KAArE,EAAR;AACAD,UAAMU,IAAN,GAAaP,MAAb;;AACA,QAAGF,KAAH;AACED,YAAMU,IAAN,IAAc,OAAOT,KAAP,GAAe,GAA7B;AALJ;AAeC;;AACD,SAVAR,aAAa4B,IAAb,CAAkB,IAAlB,EAAqB3B,MAArB,EAA6BM,KAA7B,CAUA;AA7BF;AAqBAJ,MAAMC,MAAN,CAAaC,MAAb,CAAoBwB,MAApB,CAA2B,UAAC5B,MAAD,EAASM,KAAT,EAAgBuB,UAAhB,EAA4BC,QAA5B,EAAsCC,OAAtC;AACzB,MAAAvB,GAAA;AAAAA,QAAM,IAAIK,IAAJ,EAAN;AACAiB,WAASE,IAAT,GAAgBF,SAASE,IAAT,IAAiB,EAAjC;AACAF,WAASE,IAAT,CAAcV,SAAd,GAA0BQ,SAASE,IAAT,CAAcV,SAAd,IAA2Bd,GAArD;AAaA,SAZAT,aAAa4B,IAAb,CAAkB,IAAlB,EAAqB3B,MAArB,EAA6B8B,SAASE,IAAtC,CAYA;AAhBF,4E","file":"/common/tuples.defaults.coffee","sourcesContent":["tuplePreSave = (userId, changes) ->\n\nshare.Tuples.before.insert (userId, tuple) ->\n  tuple._id = tuple._id || Random.id()\n  now = new Date()\n  _.defaults(tuple,\n    name: \"\"\n    note: \"\"\n    contents: \"\"\n    isOutputStale: true\n    isNew: true\n    ownerId: userId\n    updatedAt: now\n    createdAt: now\n  )\n  if not tuple.name\n    prefix = \"New Tuple File\"\n    count = share.Tuples.find({ name: { $regex: \"^\" + prefix, $options: \"i\" } }).count()\n    tuple.name = prefix\n    if count\n      tuple.name += \" (\" + count + \")\"\n  tuplePreSave.call(@, userId, tuple)\n\nshare.Tuples.before.update (userId, tuple, fieldNames, modifier, options) ->\n  now = new Date()\n  modifier.$set = modifier.$set or {}\n  modifier.$set.updatedAt = modifier.$set.updatedAt or now\n  tuplePreSave.call(@, userId, modifier.$set)\n"]}