{"version":3,"sources":["meteor://ðŸ’»app/server/security/tuples.coffee"],"names":["share","Tuples","allow","insert","securityRulesWrapper","userId","tuple","Match","Error","_id","Random","id","ownerId","check","App","Id","name","String","note","contents","isOutputStale","Boolean","isNew","UserId","updatedAt","Date","createdAt","update","fieldNames","modifier","options","$set","Optional","isNewUpdate","_","has","remove"],"mappings":";;;;;;;;;AAAAA,MAAMC,MAAN,CAAaC,KAAb,CACE;AAAAC,UAAQH,MAAMI,oBAAN,CAA2B,UAACC,MAAD,EAASC,KAAT;AACjC,SAAOD,MAAP;AACE,YAAM,IAAIE,MAAMC,KAAV,CAAgB,8CAAhB,CAAN;AACD;;AAADF,UAAMG,GAAN,GAAYH,MAAMG,GAAN,IAAaC,OAAOC,EAAP,EAAzB;AACAL,UAAMM,OAAN,GAAgBP,MAAhB;AACAQ,UAAMP,KAAN,EACE;AAAAG,WAAKF,MAAMO,GAAN,CAAUC,EAAf;AACAC,YAAMC,MADN;AAEAC,YAAMD,MAFN;AAGAE,gBAAUF,MAHV;AAIAG,qBAAeC,OAJf;AAKAC,aAAOD,OALP;AAMAT,eAASL,MAAMO,GAAN,CAAUS,MANnB;AAOAC,iBAAWC,IAPX;AAQAC,iBAAWD;AARX,KADF;;AAWA,QAAG,CAAInB,MAAMU,IAAb;AACE,YAAM,IAAIT,MAAMC,KAAV,CAAgB,eAAhB,CAAN;AAED;;AADD,QAAG,CAAIF,MAAMa,QAAb;AACE,YAAM,IAAIZ,MAAMC,KAAV,CAAgB,mBAAhB,CAAN;AAGD;;AACD,WAHA,IAGA;AAvBM,IAAR;AAqBAmB,UAAQ3B,MAAMI,oBAAN,CAA2B,UAACC,MAAD,EAASC,KAAT,EAAgBsB,UAAhB,EAA4BC,QAA5B,EAAsCC,OAAtC;AACjC,QAAAC,IAAA;;AAAA,SAAO1B,MAAP;AACE,YAAM,IAAIE,MAAMC,KAAV,CAAgB,8CAAhB,CAAN;AAMD;;AALD,QAAOH,WAAUC,MAAMM,OAAvB;AACE,YAAM,IAAIL,MAAMC,KAAV,CAAgB,sCAAhB,CAAN;AAOD;;AANDuB,WACE;AAAAf,YAAMT,MAAMyB,QAAN,CAAef,MAAf,CAAN;AACAC,YAAMX,MAAMyB,QAAN,CAAef,MAAf,CADN;AAEAE,gBAAUZ,MAAMyB,QAAN,CAAef,MAAf,CAFV;AAGAG,qBAAeb,MAAMyB,QAAN,CAAeX,OAAf,CAHf;AAIAC,aAAOf,MAAMyB,QAAN,CAAezB,MAAMO,GAAN,CAAUmB,WAAV,CAAsB3B,MAAMgB,KAA5B,CAAf,CAJP;AAKAE,iBAAWC;AALX,KADF;AAOAZ,UAAMgB,QAAN,EACE;AAAAE,YAAMA;AAAN,KADF;;AAGA,QAAGF,SAASE,IAAT,IAAkBG,EAAEC,GAAF,CAAMN,SAASE,IAAf,EAAqB,MAArB,CAAlB,IAAmD,CAAIF,SAASE,IAAT,CAAcf,IAAxE;AACE,YAAM,IAAIT,MAAMC,KAAV,CAAgB,eAAhB,CAAN;AASD;;AARD,QAAGqB,SAASE,IAAT,IAAkBG,EAAEC,GAAF,CAAMN,SAASE,IAAf,EAAqB,UAArB,CAAlB,IAAuD,CAAIF,SAASE,IAAT,CAAcZ,QAA5E;AACE,YAAM,IAAIZ,MAAMC,KAAV,CAAgB,mBAAhB,CAAN;AAUD;;AACD,WAVA,IAUA;AA7BM,IArBR;AAyCA4B,UAAQpC,MAAMI,oBAAN,CAA2B,UAACC,MAAD,EAASC,KAAT;AACjC,SAAOD,MAAP;AACE,YAAM,IAAIE,MAAMC,KAAV,CAAgB,8CAAhB,CAAN;AAYD;;AAXD,QAAOH,WAAUC,MAAMM,OAAvB;AACE,YAAM,IAAIL,MAAMC,KAAV,CAAgB,sCAAhB,CAAN;AAaD;;AACD,WAbA,IAaA;AAlBM;AAzCR,CADF,0E","file":"/server/security/tuples.coffee","sourcesContent":["share.Tuples.allow\n  insert: share.securityRulesWrapper (userId, tuple) ->\n    unless userId\n      throw new Match.Error(\"Operation not allowed for unauthorized users\")\n    tuple._id = tuple._id or Random.id()\n    tuple.ownerId = userId\n    check(tuple,\n      _id: Match.App.Id\n      name: String\n      note: String\n      contents: String\n      isOutputStale: Boolean\n      isNew: Boolean\n      ownerId: Match.App.UserId\n      updatedAt: Date\n      createdAt: Date\n    )\n    if not tuple.name\n      throw new Match.Error(\"Name required\")\n    if not tuple.contents\n      throw new Match.Error(\"Contents required\")\n    true\n  update: share.securityRulesWrapper (userId, tuple, fieldNames, modifier, options) ->\n    unless userId\n      throw new Match.Error(\"Operation not allowed for unauthorized users\")\n    unless userId is tuple.ownerId\n      throw new Match.Error(\"Operation not allowed for non-owners\")\n    $set =\n      name: Match.Optional(String)\n      note: Match.Optional(String)\n      contents: Match.Optional(String)\n      isOutputStale: Match.Optional(Boolean)\n      isNew: Match.Optional(Match.App.isNewUpdate(tuple.isNew))\n      updatedAt: Date\n    check(modifier,\n      $set: $set\n    )\n    if modifier.$set and _.has(modifier.$set, \"name\") and not modifier.$set.name\n      throw new Match.Error(\"Name required\")\n    if modifier.$set and _.has(modifier.$set, \"contents\") and not modifier.$set.contents\n      throw new Match.Error(\"Contents required\")\n    true\n  remove: share.securityRulesWrapper (userId, tuple) ->\n    unless userId\n      throw new Match.Error(\"Operation not allowed for unauthorized users\")\n    unless userId is tuple.ownerId\n      throw new Match.Error(\"Operation not allowed for non-owners\")\n    true\n"]}